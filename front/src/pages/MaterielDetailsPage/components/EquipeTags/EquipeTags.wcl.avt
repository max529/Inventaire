import type { Equipe } from "../../../../generated/app/Models/Equipe.lib.avt";
import { MaterielEquipe } from "../../../../generated/app/Models/MaterielEquipe.lib.avt";
import { EquipeTag } from "../EquipeTag/EquipeTag.wcl.avt";
import { ModalEquipe } from "../ModalEquipe/ModalEquipe.wcl.avt";

export class EquipeTags extends Aventus.WebComponent implements Aventus.DefaultComponent {


    //#region static

    //#endregion


    //#region props

    //#endregion


    //#region variables

    @ViewElement()
    protected listEl!: HTMLDivElement;

    public equipes: MaterielEquipe[] = [];
    //#endregion


    //#region constructor

    //#endregion


    //#region methods
    @BindThis()
    protected onChildDelete(el: EquipeTag) {
        let children = Array.from(this.listEl.children);
        let index = children.indexOf(el);
        this.equipes.splice(index, 1);
        this.listEl.removeChild(el);
    }
    protected render() {
        this.listEl.innerHTML = "";
        for(let equipe of this.equipes) {
            let el = new EquipeTag();
            el.equipe_id = equipe.id_equipe
            el.onDelete.add(this.onChildDelete);
            this.listEl.appendChild(el);
        }
    }
    protected async addEquipe() {
        const p = new ModalEquipe();
        const equipe = await p.show();
        if(equipe !== null) {
            let materielEquipe = new MaterielEquipe();
            materielEquipe.id_equipe = equipe.id;
            materielEquipe.equipe = equipe;
            this.equipes.push(materielEquipe);
            let el = new EquipeTag();
            el.equipe_id = materielEquipe.id_equipe;
            el.onDelete.add(this.onChildDelete);
            this.listEl.appendChild(el);
        }
    }

    protected override postCreation(): void {
        this.render();
    }
    //#endregion

}